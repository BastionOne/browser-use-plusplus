<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Scenario 7 – Nested Hover Menus</title>
    <style>
      body {
        margin: 0;
        font-family: "Segoe UI", Tahoma, Arial, sans-serif;
        background: #0f172a;
        color: #e2e8f0;
        display: flex;
        height: 100vh;
      }

      .sidebar {
        width: 220px;
        background: #111c44;
        padding: 20px;
        position: relative;
      }

      .nav-item {
        padding: 10px 12px;
        border-radius: 8px;
        cursor: pointer;
      }

      .nav-item:hover {
        background: rgba(255, 255, 255, 0.08);
      }

      .submenu,
      .nested-submenu {
        position: absolute;
        top: 0;
        left: 220px;
        background: #1f2a60;
        border-radius: 12px;
        box-shadow: 0 20px 40px rgba(2, 6, 23, 0.4);
        padding: 12px;
        display: none;
        min-width: 200px;
      }

      .submenu .item,
      .nested-submenu .item {
        padding: 8px 10px;
        border-radius: 8px;
        cursor: pointer;
      }

      .submenu .item:hover,
      .nested-submenu .item:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .nested-submenu {
        left: 200px;
        top: 80px;
      }

      main {
        flex: 1;
        padding: 48px;
      }

      .log {
        margin-top: 24px;
        background: #020617;
        color: #e5e7eb;
        border-radius: 12px;
        padding: 16px;
        font-family: "Fira Code", Consolas, monospace;
        max-height: 240px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <aside class="sidebar">
      <div class="nav-item">Dashboard</div>
      <div class="nav-item" id="settingsItem">Settings ▸</div>
      <div class="submenu" id="settingsMenu">
        <div class="item" data-leaf="users">Users</div>
        <div class="item" data-leaf="teams">Teams</div>
        <div class="item" id="permissionsItem">Permissions ▸</div>
      </div>
      <div class="nested-submenu" id="permissionsMenu">
        <div class="item" data-permission="roles">Roles</div>
        <div class="item" data-permission="policies">Policies</div>
      </div>
    </aside>
    <main>
      <h1>Settings navigation</h1>
      <p>Hover over “Settings” and then “Permissions” to reveal the nested menu and trigger the APIs.</p>
      <div class="log" id="logPanel" aria-live="polite">Interact with the menu to see network calls.</div>
    </main>
    <script>
      const settingsItem = document.getElementById("settingsItem");
      const settingsMenu = document.getElementById("settingsMenu");
      const permissionsItem = document.getElementById("permissionsItem");
      const permissionsMenu = document.getElementById("permissionsMenu");
      const logPanel = document.getElementById("logPanel");
      let settingsLoaded = false;
      let permissionsLoaded = false;

      function log(message) {
        const entry = document.createElement("div");
        entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        logPanel.prepend(entry);
      }

      function openMenu(menu) {
        menu.style.display = "block";
      }

      function closeMenu(menu) {
        menu.style.display = "none";
      }

      settingsItem.addEventListener("mouseenter", async () => {
        openMenu(settingsMenu);
        if (!settingsLoaded) {
          settingsLoaded = true;
          log("GET /api/settings/menu");
          const response = await fetch("/api/settings/menu");
          log(`Response: ${JSON.stringify(await response.json())}`);
        }
      });

      settingsItem.addEventListener("mouseleave", () => {
        setTimeout(() => {
          if (!settingsMenu.matches(":hover") && !permissionsMenu.matches(":hover")) {
            closeMenu(settingsMenu);
            closeMenu(permissionsMenu);
          }
        }, 100);
      });

      settingsMenu.addEventListener("mouseleave", () => {
        setTimeout(() => {
          if (!settingsItem.matches(":hover") && !permissionsMenu.matches(":hover")) {
            closeMenu(settingsMenu);
            closeMenu(permissionsMenu);
          }
        }, 100);
      });

      permissionsItem.addEventListener("mouseenter", async () => {
        openMenu(permissionsMenu);
        if (!permissionsLoaded) {
          permissionsLoaded = true;
          log("GET /api/settings/permissions/menu");
          const response = await fetch("/api/settings/permissions/menu");
          log(`Response: ${JSON.stringify(await response.json())}`);
        }
      });

      permissionsMenu.addEventListener("mouseleave", () => {
        setTimeout(() => {
          if (!permissionsItem.matches(":hover")) {
            closeMenu(permissionsMenu);
          }
        }, 100);
      });

      permissionsMenu.addEventListener("click", async (event) => {
        const item = event.target.closest("[data-permission]");
        if (!item) return;
        const target = item.dataset.permission;
        log(`GET /api/settings/permissions/${target}`);
        const response = await fetch(`/api/settings/permissions/${target}`);
        log(`Response: ${JSON.stringify(await response.json())}`);
      });
    </script>
  </body>
</html>
